<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Asistente King Recrea - Final Supremo</title>
  <style>
    /* ----------------------------------- */
    /* ANIMACIONES AVANZADAS DE REALEZA */
    /* ----------------------------------- */
    
    /* INTRO: La corona cae con estilo */
    @keyframes crown-drop-in {
      0% { transform: translateY(-150vh) scale(0.5) rotate(-10deg); opacity: 0; filter: blur(10px); }
      60% { transform: translateY(20px) scale(1.1) rotate(5deg); opacity: 1; filter: blur(0px) drop-shadow(0 0 20px #FFD700); }
      80% { transform: translateY(0) scale(1) rotate(0deg); }
      100% { transform: translateY(0) scale(1); filter: drop-shadow(0 0 30px #FFD700); }
    }

    /* Efecto de brillo recorriendo la corona */
    @keyframes shimmer-effect {
        0% { fill-opacity: 0.8; }
        50% { fill-opacity: 1; filter: brightness(1.3); }
        100% { fill-opacity: 0.8; }
    }

    /* La corona se disuelve en part√≠culas de luz (Intro) */
    @keyframes crown-dissolve-out {
        0% { transform: scale(1); opacity: 1; filter: drop-shadow(0 0 30px #FFD700); }
        100% { transform: scale(2); opacity: 0; filter: blur(20px); }
    }

    /* OUTRO FASE 2: Corona y Texto subiendo juntos */
    @keyframes combined-rise-final {
        0% { transform: translateY(60vh) scale(0.8); opacity: 0; }
        100% { transform: translateY(0) scale(1); opacity: 1; filter: drop-shadow(0 0 25px #FFD700); }
    }

    /* OUTRO FASE 3 (NUEVO): Desvanecimiento final a negro total */
    @keyframes total-fade-to-black {
        0% { opacity: 1; filter: drop-shadow(0 0 25px #FFD700); transform: scale(1); }
        100% { opacity: 0; filter: blur(20px); transform: scale(1.05); /* Ligero zoom al desaparecer */ }
    }

    /* Fondo elegante con movimiento suave */
    @keyframes elegant-background-move {
      0% { background-position: 0 0; }
      100% { background-position: 100px 100px; }
    }

    /* Aparici√≥n del t√≠tulo (Intro) */
    @keyframes title-reveal {
        0% { opacity: 0; letter-spacing: -5px; filter: blur(10px); transform: translateY(20px); }
        100% { opacity: 1; letter-spacing: 2px; filter: blur(0px); transform: translateY(0); text-shadow: 0 0 20px #FFD700; }
    }

    /* Desaparici√≥n suave del t√≠tulo (Intro) */
    @keyframes title-fade-out {
        to { opacity: 0; letter-spacing: 5px; filter: blur(5px); }
    }

    /* ----------------------------------- */
    /* ESTILOS BASE Y ELEGANCIA */
    /* ----------------------------------- */
    body {
      background: radial-gradient(circle at center, #2a2a2a 0%, #000000 100%);
      color: #FFD700;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow: hidden;
      position: relative;
    }

    /* CAPA DE INTRO/OUTRO */
    #royal-layer {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      background: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: background 1s, opacity 1s;
    }

    .crown-svg-container {
        animation: crown-drop-in 2.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
    }

    .crown-svg-path {
      fill: #FFD700;
      animation: shimmer-effect 2s ease-in-out infinite alternate;
    }

    /* T√çTULO PRINCIPAL */
    #main-title {
      display: none;
      color: #FFD700;
      font-family: 'Georgia', serif;
      font-size: 3em;
      text-transform: uppercase;
      text-align: center;
      z-index: 2;
      margin-top: 30px;
      letter-spacing: 2px;
    }

    /* FONDO DE PATR√ìN MEJORADO */
    #background-pattern {
      position: fixed;
      top: 0; left: 0; width: 100%; height: 100%;
      z-index: 0;
      background-image: url('data:image/svg+xml;charset=utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23FFD700" d="M20 70 L20 40 L30 50 L40 40 L50 60 L60 40 L70 50 L80 40 L80 70 Z M50 20 L40 30 L60 30 Z"/></svg>');
      background-size: 150px 150px;
      animation: elegant-background-move 60s linear infinite;
      mix-blend-mode: overlay;
      opacity: 0;
      transition: opacity 2s;
    }

    /* MENSAJE DE CIERRE FASE 1 (Solo texto "Gracias") */
    #final-text-message {
        position: fixed;
        top: 50%; left: 50%;
        transform: translate(-50%, -50%);
        color: #FFD700;
        font-size: 2.5em;
        font-weight: bold;
        text-align: center;
        text-shadow: 0 0 20px #FFD700;
        z-index: 2000;
        opacity: 0;
        transition: opacity 1s ease-in-out;
        pointer-events: none;
        width: 90%;
    }

    /* ESTILOS DEL CHATBOT */
    #chatbot {
      width: 350px; height: 500px;
      background-color: rgba(17, 17, 17, 0.95);
      border: 2px solid #FFD700;
      border-radius: 15px;
      overflow: hidden;
      font-size: 14px;
      display: none; 
      flex-direction: column;
      box-shadow: 0 0 40px rgba(255, 215, 0, 0.3);
      z-index: 1;
      position: relative;
      backdrop-filter: blur(5px);
    }

    #chatbot-header {
      background: linear-gradient(45deg, #FFD700, #E6AC00);
      color: #000;
      padding: 15px;
      font-weight: bold;
      text-align: center;
      letter-spacing: 1px;
      box-shadow: 0 2px 15px rgba(0,0,0,0.7);
    }

    #chatbot-messages {
      flex: 1; overflow-y: auto; padding: 15px;
      background-color: #050505;
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300" viewBox="0 0 100 100" opacity="0.08"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="60" fill="%23FFD700" font-family="Georgia, serif">KE</text></svg>');
      background-position: center; background-repeat: no-repeat;
      scrollbar-width: thin; scrollbar-color: #FFD700 #000;
    }

    #chatbot-messages p { margin: 10px 0; line-height: 1.5; padding: 8px 12px; border-radius: 10px; }
    .bot-msg { background: rgba(255, 215, 0, 0.1); border-left: 3px solid #FFD700; }
    .user-msg { background: rgba(255, 255, 255, 0.05); text-align: right; }

    #chatbot-input { display: flex; border-top: 2px solid #FFD700; }
    #chatbot-input input { flex: 1; padding: 15px; border: none; background-color: #000; color: #FFD700; outline: none; font-size: 16px; }
    #sendBtn { background-color: #222; color: #666; border: none; padding: 0 20px; cursor: not-allowed; transition: 0.3s; font-weight: bold; }
    #sendBtn:not([disabled]) { background: linear-gradient(45deg, #FFD700, #E6AC00); color: #000; cursor: pointer; }

    .whatsapp-btn { background: linear-gradient(45deg, #25D366, #128C7E); color: white !important; padding: 12px; border-radius: 8px; text-align: center; text-decoration: none; display: block; margin: 15px 0; font-weight: bold; box-shadow: 0 4px 10px rgba(37, 211, 102, 0.4); transition: transform 0.2s; }
    .whatsapp-btn:hover { transform: scale(1.02); }
    .form-confirm-btn { background: linear-gradient(45deg, #FFD700, #E6AC00); color: #000 !important; padding: 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 15px; box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4); transition: transform 0.2s; }
    .form-confirm-btn:hover { transform: scale(1.02); }
    .form-iframe { width: 100%; height: 380px; border: 2px solid #FFD700; border-radius: 10px; margin-top: 15px; background: #fff; }

  </style>
</head>
<body>

  <div id="royal-layer">
    <div class="crown-svg-container" id="royal-crown-svg">
        <svg width="220" height="220" viewBox="0 0 100 100">
            <path class="crown-svg-path" d="M10 75 Q 50 85 90 75 L 95 35 L 75 55 L 50 25 L 25 55 L 5 35 Z" stroke="#FFD700" stroke-width="2"/>
            <circle class="crown-svg-path" cx="50" cy="20" r="5" />
            <circle class="crown-svg-path" cx="15" cy="32" r="4" />
            <circle class="crown-svg-path" cx="85" cy="32" r="4" />
        </svg>
    </div>
    <h1 id="main-title">KING ENTRETENIMIENTO</h1>
  </div>

  <div id="background-pattern"></div>
  
  <div id="final-text-message">GRACIAS Y HASTA EL PR√ìXIMO EVENTO</div>

  <div id="chatbot">
    <div id="chatbot-header">üëë Asistente Real King</div>
    <div id="chatbot-messages"></div>
    <div id="chatbot-input">
      <input type="text" id="userInput" placeholder="Escribe tu consulta...">
      <button id="sendBtn" disabled>‚û§</button>
    </div>
  </div>

<script>
  const messages = document.getElementById("chatbot-messages");
  const input = document.getElementById("userInput");
  const sendBtn = document.getElementById("sendBtn");
  const chatbot = document.getElementById("chatbot");
  const mainTitle = document.getElementById("main-title");
  const royalLayer = document.getElementById("royal-layer");
  const royalCrownSvg = document.getElementById("royal-crown-svg");
  const backgroundPattern = document.getElementById("background-pattern");
  const finalTextMessage = document.getElementById("final-text-message");

  const FORMULARIO_PUBLICO_URL = "https://docs.google.com/forms/d/e/1FAIpQLScR_IHiKYHG9JUhmwsGmPoXkPvmr8FSMi2W3c0zk2a-N2xoSA/viewform?usp=dialog";
  const WHATSAPP_NUMBER = "573235484907";
  const NEQUI_NUMBER = "3233771827";
  
  let currentFlowStep = 0;
  let awaitingFormUnlock = false;

  // -----------------------------------
  // SECUENCIA DE ENTRADA MAJESTUOSA (INTRO)
  // -----------------------------------
  function runMajesticIntro() {
    setTimeout(() => {
        royalCrownSvg.style.animation = "crown-dissolve-out 1s ease-in forwards";
    }, 2800);

    setTimeout(() => {
      royalLayer.style.background = 'transparent';
      mainTitle.style.display = 'block';
      mainTitle.style.animation = 'title-reveal 1.5s ease-out forwards';
      backgroundPattern.style.opacity = '0.15';

      setTimeout(() => {
        mainTitle.style.animation = 'title-fade-out 0.5s ease-in forwards';
        setTimeout(() => {
             mainTitle.style.display = 'none';
             royalLayer.style.display = 'none';
             chatbot.style.display = 'flex';
             chatbot.animate([
                 { transform: 'scale(0.9) translateY(20px)', opacity: 0 },
                 { transform: 'scale(1) translateY(0)', opacity: 1 }
             ], { duration: 600, easing: 'cubic-bezier(0.34, 1.56, 0.64, 1)' });
             
             addMessage("üëë Saludos. Soy el Asistente Real de KING ENTRETENIMIENTO. ¬øDeseas conocer nuestros paquetes exclusivos? escribe si o paquetes", true);
        }, 500);
      }, 2500);
    }, 3500);
  }

  window.onload = runMajesticIntro;

  // -----------------------------------
  // L√ìGICA DE CIERRE EN TRES FASES (OUTRO DEFINITIVO)
  // -----------------------------------
  window.closeChatAndDisplayExitMessage = function() {
    // Ocultar elementos activos
    chatbot.animate([{ opacity: 1 }, { opacity: 0 }], { duration: 500, fill: 'forwards' });
    backgroundPattern.style.opacity = '0';
    setTimeout(() => { chatbot.style.display = 'none'; }, 500);
    
    // Preparar capa real (fondo negro)
    royalLayer.style.display = 'flex';
    royalLayer.style.background = '#000';
    royalLayer.style.opacity = '1';
    
    royalCrownSvg.style.opacity = '0'; royalCrownSvg.style.animation = 'none';
    mainTitle.style.display = 'none'; mainTitle.style.animation = 'none';

    // --- FASE 1: MOSTRAR TEXTO "GRACIAS" ---
    setTimeout(() => {
        finalTextMessage.style.opacity = '1';

        setTimeout(() => {
            finalTextMessage.style.opacity = '0'; // Ocultar "Gracias"

            // --- FASE 2: SUBIDA DE CORONA Y T√çTULO ---
            setTimeout(() => {
                 royalCrownSvg.style.opacity = '1';
                 mainTitle.style.display = 'block';
                 mainTitle.style.opacity = '1';
                 // Animaci√≥n de subida
                 const riseAnimation = "combined-rise-final 3.5s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards";
                 royalCrownSvg.style.animation = riseAnimation;
                 mainTitle.style.animation = riseAnimation;

                 // --- FASE 3: DESVANECIMIENTO FINAL A NEGRO ---
                 // Esperamos a que termine la subida (3.5s) + una pausa (e.g., 3s)
                 setTimeout(() => {
                     const fadeOutAnim = "total-fade-to-black 2.5s ease-out forwards";
                     royalCrownSvg.style.animation = fadeOutAnim;
                     mainTitle.style.animation = fadeOutAnim;
                 }, 6500); // 3500ms de subida + 3000ms de pausa

            }, 1000);

        }, 3500); // Tiempo de lectura del "Gracias"
    }, 600);
  }

  // -----------------------------------
  // L√ìGICA DEL CHAT (INTOCABLE)
  // -----------------------------------
  sendBtn.addEventListener("click", sendMessage);
  input.addEventListener("keypress", (e) => { if (e.key === "Enter") sendMessage(); });
  input.addEventListener("input", () => { sendBtn.disabled = input.value.trim().length === 0; });

  function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    addMessage(text, false);
    respondToUser(text.toLowerCase());
    input.value = "";
    sendBtn.disabled = true;
  }

  function addMessage(msg, isBot = false) {
    const p = document.createElement("p");
    p.classList.add(isBot ? 'bot-msg' : 'user-msg');
    p.innerHTML = (isBot ? "" : "") + msg;
    messages.appendChild(p);
    messages.scrollTop = messages.scrollHeight;
  }

  const PACKAGE_LIST_MESSAGE = `
    ¬°Por supuesto! Presentamos nuestros servicios (3 horas):<br><br>
    üëë <strong>Paquete B√°sico:</strong> $120.000<br>
    üëë <strong>Paquete Intermedio:</strong> $150.000<br>
    üëë <strong>Paquete King (Recomendado):</strong> $170.000<br>
    üëë <strong>Paquete Clownman (Adultos):</strong> $180.000<br><br>
    Ind√≠came cu√°l deseas detallar.
  `;

  const PACKAGE_DETAILS = {
    "basico": `üëë <strong>Paquete B√°sico ($120.000)</strong><br>‚Ä¢ Recreaci√≥n dirigida<br>‚Ä¢ Maquillaje art√≠stico<br>‚Ä¢ Show Bailable tipo hora loca<br><br>Requiere anticipo de $30.000 a Nequi: <strong>${NEQUI_NUMBER}</strong>.<br>Responde <strong>'listo'</strong> al realizar el pago.`,
    "intermedio": `üëë <strong>Paquete Intermedio ($150.000)</strong><br>‚Ä¢ Recreaci√≥n dirigida<br>‚Ä¢ Maquillaje Art√≠stico<br>‚Ä¢ Show Bailable Con Globos<br><br>Requiere anticipo de $40.000 a Nequi: <strong>${NEQUI_NUMBER}</strong>.<br>Responde <strong>'listo'</strong> al realizar el pago.`,
    "king": `üëë <strong>Paquete King ($170.000)</strong><br>‚Ä¢ Recreaci√≥n Dirigida<br>‚Ä¢ Maquillaje art√≠stico<br>‚Ä¢ Show bailable con globos y espuma<br><br>Requiere anticipo de $40.000 a Nequi: <strong>${NEQUI_NUMBER}</strong>.<br>Responde <strong>'listo'</strong> al realizar el pago.`,
    "clownman": `üëë <strong>Paquete Clownman ($180.000)</strong><br>‚Ä¢ Recreaci√≥n dirigida<br>‚Ä¢ Actividades grupales y tradicionales<br>‚Ä¢ Exclusivo para adultos<br><br>Requiere anticipo de $40.000 a Nequi: <strong>${NEQUI_NUMBER}</strong>.<br>Responde <strong>'listo'</strong> al realizar el pago.`
  };

  function respondToUser(text) {
    const cleanText = text.replace(/[^\w\s]/gi, '');
    if (currentFlowStep === 1 && (text.includes("llenar") || text.includes("formulario"))) {
      awaitingFormUnlock ? displayReservationForm() : addMessage("‚ö†Ô∏è Por favor, env√≠a primero el comprobante por WhatsApp para autorizar el registro.", true);
      return;
    }
    if (text.includes("listo") || text.includes("pague") || text.includes("pago")) {
      displayWhatsAppButtonForPayment();
    } else if (cleanText.includes("basico")) { addMessage(PACKAGE_DETAILS["basico"], true);
    } else if (cleanText.includes("intermedio")) { addMessage(PACKAGE_DETAILS["intermedio"], true);
    } else if (cleanText.includes("king")) { addMessage(PACKAGE_DETAILS["king"], true);
    } else if (cleanText.includes("clownman")) { addMessage(PACKAGE_DETAILS["clownman"], true);
    } else if (text.includes("paquete") || text.includes("si") || text.includes("precio") || text.includes("hola")) {
      addMessage(PACKAGE_LIST_MESSAGE, true);
    } else {
      addMessage("Disculpe, no reconoc√≠ esa instrucci√≥n. ¬øDesea ver la lista de paquetes? Escribe 'paquetes'.", true);
    }
  }

  function displayWhatsAppButtonForPayment() {
    currentFlowStep = 1;
    const waURL = `https://wa.me/${WHATSAPP_NUMBER}?text=Saludos King Entretenimiento, adjunto mi comprobante de pago.`;
    addMessage(`‚úÖ <strong>PASO 2: VALIDACI√ìN DE PAGO</strong><br>Use el siguiente bot√≥n seguro para enviar su comprobante v√≠a WhatsApp:<br><a href="${waURL}" target="_blank" class="whatsapp-btn" onclick="awaitingFormUnlock=true">üì± Enviar Comprobante Oficial</a><br>‚ö†Ô∏è Una vez enviado, regrese aqu√≠ y escriba <strong>'llenar'</strong> para finalizar.`, true);
  }

  function displayReservationForm() {
    currentFlowStep = 2;
    document.getElementById('chatbot-input').style.display = 'none';
    addMessage(`üéâ <strong>PASO FINAL: REGISTRO OFICIAL</strong><br>Complete los detalles de su evento a continuaci√≥n:<br><iframe src="${FORMULARIO_PUBLICO_URL}" class="form-iframe" frameborder="0"></iframe><button onclick="closeChatAndDisplayExitMessage()" class="form-confirm-btn">‚úÖ CONFIRMAR Y FINALIZAR RESERVA</button>`, true);
  }
</script>
</body>
</html>
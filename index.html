<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Asistente King Recrea - Versi√≥n Imponente</title>
  <style>
    /* ----------------------------------- */
    /* ANIMACIONES GLOBALES */
    /* ----------------------------------- */
    @keyframes crown-glow {
      0% { filter: drop-shadow(0 0 1px rgba(255, 215, 0, 0.5)); }
      50% { filter: drop-shadow(0 0 6px #FFD700); }
      100% { filter: drop-shadow(0 0 1px rgba(255, 215, 0, 0.5)); }
    }

    @keyframes background-move {
      from { background-position: 0 0; }
      to { background-position: 200px 200px; }
    }

    /* Animaci√≥n de resplandor para el t√≠tulo KING ENTRETENIMIENTO */
    @keyframes title-glow {
        0%, 100% { text-shadow: 0 0 5px rgba(255, 215, 0, 0.8), 0 0 10px rgba(255, 215, 0, 0.6); opacity: 1; }
        50% { text-shadow: 0 0 15px #FFD700, 0 0 25px #FFD700; opacity: 1; }
    }

    /* Animaci√≥n para la aparici√≥n del chatbot */
    @keyframes chatbot-appear {
        from { transform: scale(0.8); opacity: 0; }
        to { transform: scale(1); opacity: 1; }
    }

    /* ----------------------------------- */
    /* ESTILOS BASE */
    /* ----------------------------------- */
    body {
      background-color: #000;
      color: #FFD700;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      overflow-y: auto;
      position: relative;
      transition: background-color 1s; /* Transici√≥n para el fondo */
    }

    /* Clase que pondr√° el fondo en negro s√≥lido */
    .dark-mode-exit {
        background-color: #000 !important;
    }

    #background-pattern {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%; height: 100%;
      z-index: 0;
      /* Fondo de patr√≥n de corona simple */
      background-image: url('data:image/svg+xml;charset=utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><path fill="%23FFD700" fill-opacity="0.25" d="M20 70 L20 40 L30 50 L40 40 L50 60 L60 40 L70 50 L80 40 L80 70 Z M50 20 L40 30 L60 30 Z"/></svg>');
      background-size: 120px 120px;
      background-repeat: repeat;
      background-position: center;
      animation: crown-glow 5s ease-in-out infinite, background-move 100s linear infinite;
      opacity: 0.3;
      transition: opacity 1s; /* Transici√≥n para que se desvanezca el patr√≥n */
    }

    /* ----------------------------------- */
    /* ESTILOS DEL CHATBOT Y T√çTULO DE CARGA */
    /* ----------------------------------- */
    #loading-title {
        color: #FFD700;
        font-family: 'Georgia', serif;
        font-size: 2.5em;
        position: absolute;
        text-align: center;
        z-index: 2;
        animation: title-glow 3s ease-in-out forwards;
    }

    #chatbot {
      width: 350px;
      height: 450px;
      background-color: #111;
      border: 1px solid #FFD700;
      border-radius: 10px;
      overflow: hidden;
      font-size: 14px;
      display: flex;
      flex-direction: column;
      box-shadow: 0 0 15px rgba(255, 215, 0, 0.6);
      z-index: 1;
      position: relative;
      /* Ocultar inicialmente para la animaci√≥n de aparici√≥n */
      opacity: 0;
      transform: scale(0.8);
      transition: opacity 1s, transform 1s; /* Transici√≥n para el cierre */
    }

    /* ESTILO PARA EL MENSAJE DE CIERRE */
    #exit-message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #FFD700; /* Dorado */
      font-size: 1.8em;
      font-weight: bold;
      text-align: center;
      padding: 20px;
      z-index: 3;
      opacity: 0;
      transition: opacity 1s ease-in-out;
      /* Animaci√≥n de resplandor para el mensaje de cierre */
      text-shadow: 0 0 10px #FFD700, 0 0 20px rgba(255, 215, 0, 0.8);
    }

    /* ----------------------------------- */
    /* ESTILOS INTERNOS DEL CHATBOT (RESTO DEL C√ìDIGO) */
    /* ----------------------------------- */
    #chatbot-header {
      background-color: #FFD700;
      color: #000;
      padding: 10px;
      font-weight: bold;
      text-align: center;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
    }

    #chatbot-messages {
      flex: 1;
      overflow-y: auto;
      padding: 10px;
      color: #FFD700;
      background-color: #050505;
      /* Marca de agua con iniciales */
      background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="300" height="300" viewBox="0 0 100 100" opacity="0.1"><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="60" fill="%23FFD700" font-family="Georgia, serif">KE</text></svg>');
      background-size: 60%;
      background-position: center;
      background-repeat: no-repeat;
    }

    #chatbot-messages p {
      margin: 5px 0;
      padding: 5px;
      border-radius: 5px;
      word-wrap: break-word;
    }

    .final-message {
      font-size: 1.1em;
      font-weight: bold;
      text-align: center;
      margin: 20px 0;
      color: #fff;
      background-color: #333;
      padding: 15px;
      border-radius: 8px;
      border: 2px solid #FFD700;
    }

    .whatsapp-btn {
      background-color: #25D366;
      color: white !important;
      padding: 10px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      display: block;
      text-align: center;
      text-decoration: none;
      margin: 10px auto;
      width: 90%;
      transition: background-color 0.3s;
    }

    .form-confirm-btn {
      background-color: #FFD700;
      color: #000 !important;
      padding: 12px 15px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
      display: block;
      text-align: center;
      text-decoration: none;
      margin: 15px auto 5px auto;
      width: 95%;
      transition: background-color 0.3s;
      box-shadow: 0 4px 8px rgba(255, 215, 0, 0.4);
    }

    .form-confirm-btn:hover {
      background-color: #fff;
    }

    #chatbot-input {
      display: flex;
      border-top: 1px solid #FFD700;
    }

    #chatbot-input input {
      flex: 1;
      padding: 10px;
      border: none;
      background-color: #050505;
      color: #FFD700;
      margin: 0;
      border-radius: 0;
    }

    #chatbot-input #sendBtn {
      background-color: #333;
      color: #888;
      border: none;
      padding: 10px;
      cursor: not-allowed;
      font-weight: bold;
      border-radius: 0;
      transition: all 0.3s;
    }

    #chatbot-input #sendBtn:not([disabled]) {
      background-color: #FFD700;
      color: #000;
      cursor: pointer;
    }

    .form-iframe {
      width: 100%;
      height: 350px;
      border: 2px solid #FFD700;
      border-radius: 5px;
      background-color: #222;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <div id="background-pattern"></div>
  <h1 id="loading-title" style="display: none;">KING ENTRETENIMIENTO</h1>

  <div id="exit-message">GRACIAS Y HASTA EL PR√ìXIMO EVENTO</div>

  <div id="chatbot">
    <div id="chatbot-header">üëë King Entretenimiento</div>
    <div id="chatbot-messages"></div>
    <div id="chatbot-input">
      <input type="text" id="userInput" placeholder="Escribe algo...">
      <button id="sendBtn" disabled>Enviar</button>
    </div>
<script>
  const messages = document.getElementById("chatbot-messages");
  const input = document.getElementById("userInput");
  const sendBtn = document.getElementById("sendBtn");
  const chatbot = document.getElementById("chatbot");
  const loadingTitle = document.getElementById("loading-title");
  const exitMessage = document.getElementById("exit-message"); 
  const body = document.body; // Referencia al body
  const backgroundPattern = document.getElementById("background-pattern"); // Referencia al patr√≥n

  const FORMULARIO_PUBLICO_URL = "https://docs.google.com/forms/d/e/1FAIpQLScR_IHiKYHG9JUhmwsGmPoXkPvmr8FSMi2W3c0zk2a-N2xoSA/viewform?usp=dialog";
  const WHATSAPP_NUMBER = "573235484907";
  const NEQUI_NUMBER = "3233771827";
  let currentFlowStep = 0;
  let awaitingFormUnlock = false;

  // -----------------------------------
  // L√ìGICA DE CARGA Y ANIMACI√ìN
  // -----------------------------------

  function startLoadAnimation() {
      loadingTitle.style.display = 'block';
      setTimeout(() => {
          loadingTitle.style.display = 'none';
          chatbot.style.animation = 'chatbot-appear 0.6s ease-out forwards';
          setTimeout(() => {
              addMessage("üëë Bienvenido, somos KING ENTRETENIMIENTO. ¬øDeseas saber sobre nuestros paquetes?", true);
          }, 600);
      }, 3500);
  }

  window.onload = startLoadAnimation;


  // -----------------------------------
  // L√ìGICA DE CIERRE AUTOM√ÅTICO (OSCURECIMIENTO DE PANTALLA)
  // -----------------------------------
  window.closeChatAndDisplayExitMessage = function() {
    currentFlowStep = 0;
    awaitingFormUnlock = false;
    
    // 1. Ocultar el chatbot
    chatbot.style.opacity = '0';
    chatbot.style.transform = 'scale(0.8)';
    
    // 2. Oscurecer el fondo inmediatamente
    body.classList.add('dark-mode-exit');
    backgroundPattern.style.opacity = '0'; // Desaparecer el patr√≥n
    
    // 3. Despu√©s de un peque√±o retraso, mostrar el mensaje de salida
    setTimeout(() => {
        chatbot.style.display = 'none';
        exitMessage.style.opacity = '1';
    }, 1000); // 1 segundo para que se vea la animaci√≥n de cierre del chatbot y del fondo
  }


  // -----------------------------------
  // L√ìGICA DE INTERACCI√ìN DEL CHAT (RESTO DEL C√ìDIGO)
  // -----------------------------------

  sendBtn.addEventListener("click", sendMessage);
  input.addEventListener("keypress", function (e) {
    if (e.key === "Enter") sendMessage();
  });

  input.addEventListener("input", function() {
    sendBtn.disabled = input.value.trim().length === 0;
  });

  function sendMessage() {
    const text = input.value.trim();
    if (text === "") return;
    addMessage(text, false);
    respondToUser(text.toLowerCase());
    input.value = "";
    sendBtn.disabled = true;
  }

  function addMessage(msg, isBot = false) {
    const p = document.createElement("p");
    const prefix = isBot ? "üëë " : "üë§ ";
    p.innerHTML = prefix + msg;
    messages.appendChild(p);
    messages.scrollTop = messages.scrollHeight;
  }

  function displayWhatsAppButtonForPayment() {
    currentFlowStep = 1;
    const messageText = encodeURIComponent("Hola, ya pagu√© el anticipo de $30.000 COP. Aqu√≠ adjunto el comprobante.");
    const whatsappURL = `https://wa.me/${WHATSAPP_NUMBER}?text=${messageText}`;
    const buttonHTML = `
      <p>‚úÖ <strong>PASO 2 DE 3: COMPROBANTE</strong> ¬°Perfecto!
      Haz clic para enviar el comprobante de pago.</p>
      <a href="${whatsappURL}" target="_blank" class="whatsapp-btn" onclick="unlockFormConfirmation()">Enviar Comprobante (WhatsApp)</a>
      <p style="margin-top: 15px; font-weight: bold; color: #FFF;">‚ö†Ô∏è <strong>¬°IMPORTANTE!</strong> Despu√©s de hacer clic y enviar el comprobante, <strong>vuelve a este chat y escribe 'llenar'</strong> para desbloquear el formulario.</p>
    `;
    addMessage(buttonHTML, true);
  }

  window.unlockFormConfirmation = function() {
    awaitingFormUnlock = true;
  }

  function displayReservationForm() {
    currentFlowStep = 2;
    document.getElementById('chatbot-input').style.display = 'none';
    const iframeHTML = `
      <p>üéâ <strong>PASO 3 DE 3: ¬°Completa el formulario a continuaci√≥n!</strong></p>
      <iframe src="${FORMULARIO_PUBLICO_URL}" class="form-iframe" frameborder="0">Cargando...</iframe>
      <p style="font-size: 13px; margin-top: 5px;">‚úÖ <strong>IMPORTANTE:</strong> Una vez que env√≠es el formulario, <strong>vuelve a este chat</strong> y haz clic en el bot√≥n de abajo para obtener tu confirmaci√≥n final.</p>
      <button onclick="closeChatAndDisplayExitMessage()" class="form-confirm-btn">‚úÖ Ya llen√© el formulario y envi√© mi reserva</button>
    `;
    addMessage(iframeHTML, true);
  }

  const PACKAGE_LIST_MESSAGE = `
    ¬°Claro!
    Estos son nuestros paquetes de recreaci√≥n (todos con una duraci√≥n de <strong>3 horas</strong> de servicio):<br>
    üëë <strong>Paquete B√°sico:</strong> $120.000 COP<br>
    üëë <strong>Paquete Intermedio:</strong> $150.000 COP<br>
    üëë <strong>Paquete King:</strong> $170.000 COP<br>
    üëë <strong>Paquete Clownman:</strong> $180.000 COP<br>
    Responde con el nombre del paquete que te interesa para conocer el proceso de reserva.
  `;

  const PACKAGE_DETAILS = {
    "b√°sico": `
      üëë <strong>Paquete B√°sico ($120.000 COP)</strong><br>
      ‚Ä¢ Duraci√≥n: <strong>3 Horas de Servicio</strong><br>
      ‚Ä¢ Recreaci√≥n dirigida<br>
      ‚Ä¢ Maquillaje art√≠stico<br>
      ‚Ä¢ Show Bailable tipo hora loca<br><br>
      Anticipo: $30.000 COP (Nequi: ${NEQUI_NUMBER})<br>
      Responde <strong>'listo'</strong> para continuar.
    `,
    "intermedio": `
      üëë <strong>Paquete Intermedio ($150.000 COP)</strong><br>
      ‚Ä¢ Duraci√≥n: <strong>3 Horas de Servicio</strong><br>
      ‚Ä¢ Recreaci√≥n dirigida<br>
      ‚Ä¢ Maquillaje Art√≠stico<br>
      ‚Ä¢ Show Bailable Con Globos<br><br>
      Anticipo: $40.000 COP (Nequi: ${NEQUI_NUMBER})<br>
      Responde <strong>'listo'</strong> para continuar.
    `,
    "king": `
      üëë <strong>Paquete King ($170.000 COP)</strong><br>
      ‚Ä¢ Duraci√≥n: <strong>3 Horas de Servicio</strong><br>
      ‚Ä¢ Recreaci√≥n Dirigida<br>
      ‚Ä¢ Maquillaje art√≠stico<br>
      ‚Ä¢ Show bailable con globos <br><br>
      Anticipo: $40.000 COP (Nequi: ${NEQUI_NUMBER})<br>
      Responde <strong>'listo'</strong> para continuar.
    `,
    "clownman": `
      üëë <strong>Paquete Clownman ($190.000 COP)</strong><br>
      ‚Ä¢ Duraci√≥n: <strong>3 Horas de Servicio</strong><br>
      ‚Ä¢ Recreaci√≥n dirigida<br>
      ‚Ä¢ Actividades grupales y tradicionales<br>
      ‚Ä¢ Solo Para adultos <br><br>
      Anticipo: $40.000 COP (Nequi: ${NEQUI_NUMBER})<br>
      Responde <strong>'listo'</strong> para continuar.
    `
  };

  function respondToUser(text) {
    const is_confirmation = text.includes("listo") || text.includes("pague") || text.includes("transferencia") || text.includes("consignado") ||
    text.includes("pago");
    const is_open_form_command = text.includes("llenar") || text.includes("formulario");
    const is_general_package_request = text.includes("paquetes") || text.includes("paquete") || text.includes("costos") || text.includes("si");
    const is_reserva_request = text.includes("reserva") ||
    text.includes("servicio") || text.includes("separacion");
    const is_greeting = text.includes("hola") || text.includes("buenos") || text.includes("iniciar");

    let response = "";
    const cleanText = text.replace(/[^\w\s]/gi, '').toLowerCase();

    // 1. L√≥gica para desbloquear el formulario (Prioridad)
    if (currentFlowStep === 1 && is_open_form_command && awaitingFormUnlock) {
      displayReservationForm();
      return;
    } else if (currentFlowStep === 1 && is_open_form_command && !awaitingFormUnlock) {
      response = "‚ö†Ô∏è Primero haz clic en el bot√≥n de WhatsApp para enviar tu comprobante. Luego escribe 'llenar' para continuar.";
      addMessage(response, true);
      return;
    } else if (currentFlowStep === 1 && is_confirmation) {
      response = "¬°Perfecto! Ahora haz clic en el bot√≥n de WhatsApp para enviar tu comprobante. Luego escribe 'llenar'.";
      addMessage(response, true);
      return;
    }
    
    // 2. L√≥gica para paquetes espec√≠ficos (Alta prioridad)
    if (cleanText.includes("basico")) {
      response = PACKAGE_DETAILS["b√°sico"];
    } else if (cleanText.includes("intermedio")) {
      response = PACKAGE_DETAILS["intermedio"];
    } else if (cleanText.includes("clownman") || cleanText.includes("clownman")) {
      response = PACKAGE_DETAILS["clownman"];
    } else if (cleanText.includes("king")) {
      response = PACKAGE_DETAILS["king"];
    } else if (is_confirmation) {
      // Confirmaci√≥n de pago (si no estaba en el paso 1, lo iniciamos)
      displayWhatsAppButtonForPayment();
      return;
    }
    
    // 3. L√≥gica para listado general y bienvenida (Baja prioridad)
    else if (is_general_package_request || is_reserva_request) {
      addMessage(PACKAGE_LIST_MESSAGE, true);
      return;
    } else if (is_greeting) {
      response = "üëë Bienvenido, somos KING ENTRETENIMIENTO. ¬øDeseas saber sobre nuestros paquetes?";
    } else {
      response = "Disculpa, no entend√≠. Por favor, escribe el nombre del paquete que te interesa (ej. 'b√°sico') o escribe 'paquetes' para ver la lista completa.";
    }

    if (response) {
        addMessage(response, true);
    }
  }
</script>
</body>
</html>